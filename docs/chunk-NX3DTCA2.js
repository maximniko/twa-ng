import{a as S}from"./chunk-OQP2OZ6Y.js";import{a as A}from"./chunk-FKK63HNY.js";import{c as R}from"./chunk-GGE5B5J2.js";import{a as $}from"./chunk-UAGEVCIM.js";import{a as O}from"./chunk-6HWPIXC6.js";import{a as k}from"./chunk-WQJBFNG4.js";import{Db as j,Ea as y,Fb as F,Gb as b,M as g,Na as w,Oa as u,Pa as f,Sa as C,T as I,aa as c,ba as m,ib as v,ja as x,na as _,oa as p,ra as D,ua as L,ub as T,va as M,wa as a,wb as E,xa as r,xb as B,ya as d}from"./chunk-WTVUGHJS.js";var P=(()=>{class e{constructor(){this.transactions=[],this.doughnutChartLabels=[],this.doughnutChartDatasets=[],this.doughnutChartOptions={animation:{animateRotate:!0,animateScale:!0},responsive:!0}}ngOnInit(){this.initChartData()}initChartData(){let t=this.chartDate;this.doughnutChartLabels.push(...t.labels),this.doughnutChartDatasets.push({data:t.data,label:"sum",borderWidth:1,backgroundColor:t.backgroundColors})}get chartDate(){let t=this.transactions.reduce((n,o)=>(n[o.tag.id]?n[o.tag.id].total+=o.total:n[o.tag.id]={id:o.tag.id,title:o.tag.title,total:o.total},n),{}),s=Object.keys(t).reduce((n,o)=>(n.push(t[o]),n),[]).sort((n,o)=>n.total>o.total?-1:1),h=5;return s.reduce((n,o,W)=>(W<h?(n.labels.push(o.title),n.backgroundColors.push(S(o.id)),n.data.push(o.total)):(n.labels[h]="Others",n.backgroundColors.push("#999"),n.data[h]=(n.data[h]??0)+o.total),n),{labels:[],backgroundColors:[],data:[]})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=g({type:e,selectors:[["chart-transactions-doughnut"]],inputs:{transactions:"transactions"},standalone:!0,features:[C],decls:1,vars:5,consts:[["baseChart","",3,"labels","datasets","options","legend","type"]],template:function(i,s){i&1&&d(0,"canvas",0),i&2&&p("labels",s.doughnutChartLabels)("datasets",s.doughnutChartDatasets)("options",s.doughnutChartOptions)("legend",!0)("type","doughnut")},dependencies:[v,R],encapsulation:2})}}return e})();function q(e,l){return e.toLocaleDateString(l,{month:"short",day:"numeric"})}var z=(e,l)=>l.id;function H(e,l){if(e&1&&(a(0,"a",1),d(1,"div",2),a(2,"div",3)(3,"div",4)(4,"div",5),u(5),r(),a(6,"div"),u(7),r()(),a(8,"div",4)(9,"div"),u(10,"Sum:"),r(),a(11,"div"),u(12),r()()(),a(13,"div",6),I(),a(14,"svg",7),d(15,"use"),r()()()),e&2){let t=l.$implicit,i=y(2);p("routerLink",i.routeCreator.transactionEdit(t)),c(),w("width:4rem;height:4rem;background-color:",i.getColor(t.tag.id),";"),c(4),f(t.tag.title),c(2),f(i.toLocalDate(t.date)),c(5),f(t.total),c(3),_("href","#"+i.symbols.chevronRight,null,"xlink")}}function J(e,l){if(e&1&&(a(0,"div",0),L(1,H,16,8,"a",1,z),r()),e&2){let t=y();c(),M(t.transactions)}}var G=(()=>{class e{constructor(t){this.twa=t,this.transactions=[],this.routeCreator=b,this.symbols=O,this.getColor=S,this.toLocalDate=i=>q(i,this.twa.getUserLanguageCode())}static{this.\u0275fac=function(i){return new(i||e)(m(k))}}static{this.\u0275cmp=g({type:e,selectors:[["chart-transactions-list"]],inputs:{transactions:"transactions"},standalone:!0,features:[C],decls:1,vars:1,consts:[[1,"list-group"],[1,"list-group-item","list-group-item-action","hstack","pe-0",3,"routerLink"],[1,"rounded-circle","d-flex"],[1,"vstack","ps-3","jcc"],[1,"jcb"],[1,"text-truncate"],[1,"jcc","px-3"],[1,"bi"]],template:function(i,s){i&1&&x(0,J,3,0,"div",0),i&2&&D(s.transactions.length?0:-1)},dependencies:[v,B],encapsulation:2})}}return e})();function K(e,l){if(e&1&&(a(0,"div",3),d(1,"chart-transactions-doughnut",4),r(),a(2,"div",3),d(3,"chart-transactions-list",4),r()),e&2){let t=y();c(),p("transactions",t.transactions),c(2),p("transactions",t.transactions)}}var ft=(()=>{class e{constructor(t,i,s,h){this.twa=t,this.service=i,this.activatedRoute=s,this.router=h,this.transactions=[],this.routeCreator=b,this.activatedRoute.data.subscribe(n=>{this.categoryItem=n.categoryItem,this.service.list(new F({categoryId:this.categoryItem.id})).subscribe(o=>this.transactions=o)})}ngOnInit(){this.twa.backButtonOnClick(this.goBack),this.twa.setMainButton({text:"Add transaction",is_active:!0,is_visible:!0,has_shine_effect:!0},this.onMainClick)}ngOnDestroy(){this.twa.offMainButton(this.onMainClick),this.twa.offBackButton(this.goBack)}goBack(){this.router.navigate([b.main()])}onMainClick(){this.router.navigate([b.transactionAddByCategory(this.categoryItem)])}static{this.\u0275fac=function(i){return new(i||e)(m(k),m(j),m(T),m(E))}}static{this.\u0275cmp=g({type:e,selectors:[["ng-component"]],hostAttrs:[1,"d-flex","flex-column","h-100"],standalone:!0,features:[C],decls:7,vars:2,consts:[[1,"accent-border","accent-border-top","accent-bg-shadow","card","rounded-5"],[1,"hstack","p-3","pb-0"],[1,"m-auto","text-center","h5"],[1,"card-body","p-2"],[3,"transactions"]],template:function(i,s){i&1&&(a(0,"section",0)(1,"div",1)(2,"span",2),u(3),r(),d(4,"period-selector"),r(),x(5,K,4,2),d(6,"period-pagination"),r()),i&2&&(c(3),f(s.categoryItem.title),c(2),D(s.transactions.length?5:-1))},dependencies:[v,P,G,A,$],encapsulation:2})}}return e})();export{ft as ChartCategoryComponent};
