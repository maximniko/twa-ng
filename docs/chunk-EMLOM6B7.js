import{a as O}from"./chunk-B3OX46JI.js";import{a as B}from"./chunk-OQP2OZ6Y.js";import{a as F}from"./chunk-ZZSCDCLG.js";import{c as j}from"./chunk-VM3LYK5D.js";import{a as _,b as w}from"./chunk-3T2VUSZV.js";import"./chunk-CTBJ2Y2T.js";import"./chunk-KQRQU7YE.js";import"./chunk-YAH7JT7V.js";import{b as S,c as f}from"./chunk-QUWN2NEK.js";import{$ as d,Bb as k,Ca as D,Db as x,K as h,Kb as T,Ma as C,Na as I,Pb as M,Ta as p,_ as u,ha as v,ma as l,pa as y,pb as g,t as b,ua as m,va as s,wa as r}from"./chunk-DIXJAQJD.js";var E=(()=>{class o{constructor(){this.transactions=[],this.doughnutChartLabels=[],this.doughnutChartDatasets=[],this.doughnutChartOptions={animation:{animateRotate:!0,animateScale:!0},plugins:{legend:{position:"bottom",labels:{font:{size:16}}}},responsive:!0}}ngOnInit(){this.initChartData()}initChartData(){let t=this.chartDate;this.doughnutChartLabels.push(...t.labels),this.doughnutChartDatasets.push({data:t.data,label:"sum",borderWidth:1,backgroundColor:t.backgroundColors})}get chartDate(){let t=this.transactions.reduce((e,i)=>(e[i.tag.id]?e[i.tag.id].total+=i.total:e[i.tag.id]={id:i.tag.id,title:i.tag.title,total:i.total},e),{}),a=Object.keys(t).reduce((e,i)=>(e.push(t[i]),e),[]).sort((e,i)=>e.total>i.total?-1:1),c=5;return a.reduce((e,i,R)=>(R<c?(e.labels.push(i.title),e.backgroundColors.push(B(i.id)),e.data.push(i.total)):(e.labels[c]="Others",e.backgroundColors.push("#999"),e.data[c]=(e.data[c]??0)+i.total),e),{labels:[],backgroundColors:[],data:[]})}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=h({type:o,selectors:[["chart-transactions-doughnut"]],inputs:{transactions:"transactions"},standalone:!0,features:[p],decls:1,vars:5,consts:[["baseChart","",3,"labels","datasets","options","legend","type"]],template:function(n,a){n&1&&r(0,"canvas",0),n&2&&l("labels",a.doughnutChartLabels)("datasets",a.doughnutChartDatasets)("options",a.doughnutChartOptions)("legend",!0)("type","doughnut")},dependencies:[g,j],encapsulation:2})}}return o})();function q(o,L){if(o&1&&(m(0,"section",0)(1,"div",2)(2,"span",3),C(3),s(),r(4,"period-selector"),s(),m(5,"div",4),r(6,"chart-transactions-doughnut",5),s(),m(7,"div",4),r(8,"transactions-list",5),s(),r(9,"period-pagination"),s()),o&2){let t=D();u(3),I(t.categoryItem.title),u(3),l("transactions",t.transactions),u(2),l("transactions",t.transactions)}}function z(o,L){o&1&&(m(0,"div",1)(1,"span",6),C(2,"Loading..."),s()())}var it=(()=>{class o{constructor(t,n,a,c,e){this.twa=t,this.filter=n,this.service=a,this.activatedRoute=c,this.router=e,this.transactions=[],this.routeCreator=f,this.activatedRoute.data.subscribe(i=>{this.categoryItem=i.categoryItem})}ngOnInit(){this.loadTransactions(this.filter.fromTo),this.filterSubscription=this.filter.nextFromTo.pipe(b(1e3)).subscribe(t=>this.loadTransactions(t)),this.twa.backButtonOnClick(()=>this.goBack()),this.twa.setMainButton({text:"Add transaction",is_active:!0,is_visible:!0,has_shine_effect:!0},()=>this.onMainClick())}loadTransactions(t){this.service.list(new S(Object.assign(t,{categoryId:this.categoryItem.id}))).subscribe(n=>this.transactions=n)}ngOnDestroy(){this.serviceSubscription?.unsubscribe(),this.twa.offMainButton(()=>this.onMainClick()),this.twa.offBackButton(()=>this.goBack())}goBack(){this.router.navigate([f.chart()])}onMainClick(){this.router.navigate([f.transactionAddByCategory(this.categoryItem)])}static{this.\u0275fac=function(n){return new(n||o)(d(M),d(_),d(T),d(k),d(x))}}static{this.\u0275cmp=h({type:o,selectors:[["ng-component"]],hostAttrs:[1,"d-flex","flex-column","h-100"],standalone:!0,features:[p],decls:2,vars:1,consts:[[1,"accent-border","accent-border-top","accent-bg-shadow","card","rounded-5"],["role","status",1,"m-auto","spinner-border"],[1,"hstack","p-3","pb-0"],[1,"m-auto","text-center","h5"],[1,"card-body","p-2"],[3,"transactions"],[1,"visually-hidden"]],template:function(n,a){n&1&&v(0,q,10,3,"section",0)(1,z,3,0,"div",1),n&2&&y(a.transactions.length?0:1)},dependencies:[g,E,F,w,O],encapsulation:2})}}return o})();export{it as ChartCategoryComponent};
