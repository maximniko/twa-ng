import{a as F}from"./chunk-CMI4THZY.js";import{a as O}from"./chunk-OQP2OZ6Y.js";import{a as E}from"./chunk-BOMYRPHB.js";import{c as L}from"./chunk-4BFCTYDP.js";import{a as B,b as j}from"./chunk-LSE4SL3F.js";import"./chunk-CTBJ2Y2T.js";import"./chunk-DHROBJAE.js";import{b as _,c as C}from"./chunk-XCFECYTE.js";import{Ea as k,Gb as T,Ib as S,M as h,Oa as v,Pa as x,Pb as M,Ub as w,Vb as f,Wa as p,aa as u,ba as s,ja as I,oa as l,ra as D,ub as g,v as y,wa as m,xa as r,ya as c}from"./chunk-7ZW7U2TK.js";var A=(()=>{class o{constructor(t){this.localisation=t,this.transactions=[],this.doughnutChartLabels=[],this.doughnutChartDatasets=[],this.doughnutChartOptions={animation:{animateRotate:!0,animateScale:!0},plugins:{legend:{position:"bottom",labels:{font:{size:16}}}},responsive:!0}}ngOnInit(){this.initChartData()}initChartData(){let t=this.chartDate;this.doughnutChartLabels.push(...t.labels),this.doughnutChartDatasets.push({data:t.data,label:this.localisation.t.sum??"sum",borderWidth:1,backgroundColor:t.backgroundColors})}get chartDate(){let t=this.transactions.reduce((e,i)=>(e[i.tag.id]?e[i.tag.id].total+=i.total:e[i.tag.id]={id:i.tag.id,title:i.tag.title,total:i.total},e),{}),a=Object.keys(t).reduce((e,i)=>(e.push(t[i]),e),[]).sort((e,i)=>e.total>i.total?-1:1),d=5;return a.reduce((e,i,b)=>(b<d?(e.labels.push(i.title),e.backgroundColors.push(O(i.id)),e.data.push(i.total)):(e.labels[d]="Others",e.backgroundColors.push("#999"),e.data[d]=(e.data[d]??0)+i.total),e),{labels:[],backgroundColors:[],data:[]})}static{this.\u0275fac=function(n){return new(n||o)(s(f))}}static{this.\u0275cmp=h({type:o,selectors:[["chart-transactions-doughnut"]],inputs:{transactions:"transactions"},standalone:!0,features:[p],decls:1,vars:5,consts:[["baseChart","",3,"labels","datasets","options","legend","type"]],template:function(n,a){n&1&&c(0,"canvas",0),n&2&&l("labels",a.doughnutChartLabels)("datasets",a.doughnutChartDatasets)("options",a.doughnutChartOptions)("legend",!0)("type","doughnut")},dependencies:[g,L],encapsulation:2})}}return o})();function P(o,R){if(o&1&&(m(0,"section",0)(1,"div",2)(2,"span",3),v(3),r(),c(4,"period-selector"),r(),m(5,"div",4),c(6,"chart-transactions-doughnut",5),r(),m(7,"div",4),c(8,"transactions-list",5),r(),c(9,"period-pagination"),r()),o&2){let t=k();u(3),x(t.categoryItem.title),u(3),l("transactions",t.transactions),u(2),l("transactions",t.transactions)}}function W(o,R){o&1&&(m(0,"div",1)(1,"span",6),v(2,"Loading..."),r()())}var nt=(()=>{class o{constructor(t,n,a,d,e,i){this.twa=t,this.filter=n,this.service=a,this.activatedRoute=d,this.localisation=e,this.router=i,this.transactions=[],this.routeCreator=C,this.activatedRoute.data.subscribe(b=>{this.categoryItem=b.categoryItem})}ngOnInit(){this.loadTransactions(this.filter.fromTo),this.filterSubscription=this.filter.nextFromTo.pipe(y(1e3)).subscribe(t=>this.loadTransactions(t)),this.twa.backButtonOnClick(()=>this.goBack()),this.twa.setMainButton({text:this.localisation.t.Add??"Add",is_active:!0,is_visible:!0,has_shine_effect:!0},()=>this.onMainClick())}loadTransactions(t){this.service.list(new _(Object.assign(t,{categoryId:this.categoryItem.id}))).subscribe(n=>this.transactions=n)}ngOnDestroy(){this.serviceSubscription?.unsubscribe(),this.twa.offMainButton(()=>this.onMainClick()),this.twa.offBackButton(()=>this.goBack())}goBack(){this.router.navigate([C.chart()])}onMainClick(){this.router.navigate([C.transactionAddByCategory(this.categoryItem)])}static{this.\u0275fac=function(n){return new(n||o)(s(w),s(B),s(M),s(T),s(f),s(S))}}static{this.\u0275cmp=h({type:o,selectors:[["ng-component"]],hostAttrs:[1,"d-flex","flex-column","h-100"],standalone:!0,features:[p],decls:2,vars:1,consts:[[1,"accent-border","accent-border-top","accent-bg-shadow","card","rounded-5"],["role","status",1,"m-auto","spinner-border"],[1,"hstack","p-3","pb-0"],[1,"m-auto","text-center","h5"],[1,"card-body","p-2"],[3,"transactions"],[1,"visually-hidden"]],template:function(n,a){n&1&&I(0,P,10,3,"section",0)(1,W,3,0,"div",1),n&2&&D(a.transactions.length?0:1)},dependencies:[g,A,E,j,F],encapsulation:2})}}return o})();export{nt as ChartCategoryComponent};
