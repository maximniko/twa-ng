import{a as I}from"./chunk-OQP2OZ6Y.js";import{a as G}from"./chunk-SU6XQPXQ.js";import{c as $}from"./chunk-S2DLXYK6.js";import{a as q,b as z}from"./chunk-5FEUUNCK.js";import"./chunk-CTBJ2Y2T.js";import{a as A}from"./chunk-UFVXHCOO.js";import{a as k}from"./chunk-UBJEU3DX.js";import{Bb as j,Cb as B,Ea as x,Ib as F,Jb as O,Lb as R,M as g,Mb as b,Na as M,Oa as m,Pa as f,T as _,Va as C,aa as c,ba as l,ja as y,na as T,nb as v,oa as p,ra as S,ua as L,v as D,va as w,wa as a,xa as r,ya as d,zb as E}from"./chunk-T77L2YF3.js";var U=(()=>{class e{constructor(){this.transactions=[],this.doughnutChartLabels=[],this.doughnutChartDatasets=[],this.doughnutChartOptions={animation:{animateRotate:!0,animateScale:!0},plugins:{legend:{position:"bottom",labels:{font:{size:16}}}},responsive:!0}}ngOnInit(){this.initChartData()}initChartData(){let t=this.chartDate;this.doughnutChartLabels.push(...t.labels),this.doughnutChartDatasets.push({data:t.data,label:"sum",borderWidth:1,backgroundColor:t.backgroundColors})}get chartDate(){let t=this.transactions.reduce((n,o)=>(n[o.tag.id]?n[o.tag.id].total+=o.total:n[o.tag.id]={id:o.tag.id,title:o.tag.title,total:o.total},n),{}),s=Object.keys(t).reduce((n,o)=>(n.push(t[o]),n),[]).sort((n,o)=>n.total>o.total?-1:1),h=5;return s.reduce((n,o,H)=>(H<h?(n.labels.push(o.title),n.backgroundColors.push(I(o.id)),n.data.push(o.total)):(n.labels[h]="Others",n.backgroundColors.push("#999"),n.data[h]=(n.data[h]??0)+o.total),n),{labels:[],backgroundColors:[],data:[]})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=g({type:e,selectors:[["chart-transactions-doughnut"]],inputs:{transactions:"transactions"},standalone:!0,features:[C],decls:1,vars:5,consts:[["baseChart","",3,"labels","datasets","options","legend","type"]],template:function(i,s){i&1&&d(0,"canvas",0),i&2&&p("labels",s.doughnutChartLabels)("datasets",s.doughnutChartDatasets)("options",s.doughnutChartOptions)("legend",!0)("type","doughnut")},dependencies:[v,$],encapsulation:2})}}return e})();var K=(e,u)=>u.id;function N(e,u){if(e&1&&(a(0,"a",1),d(1,"div",2),a(2,"div",3)(3,"div",4)(4,"div",5),m(5),r(),a(6,"div"),m(7),r()(),a(8,"div",4)(9,"div"),m(10,"Sum:"),r(),a(11,"div"),m(12),r()()(),a(13,"div",6),_(),a(14,"svg",7),d(15,"use"),r()()()),e&2){let t=u.$implicit,i=x(2);p("routerLink",i.routeCreator.transactionEdit(t)),c(),M("width:4rem;height:4rem;background-color:",i.getColor(t.tag.id),";"),c(4),f(t.tag.title),c(2),f(i.toLocalDate(t.date)),c(5),f(t.total),c(3),T("href","#"+i.symbols.chevronRight,null,"xlink")}}function Q(e,u){if(e&1&&(a(0,"div",0),L(1,N,16,8,"a",1,K),r()),e&2){let t=x();c(),w(t.transactions)}}var W=(()=>{class e{constructor(t){this.twa=t,this.transactions=[],this.routeCreator=b,this.symbols=A,this.getColor=I,this.toLocalDate=i=>O(i,this.twa.getUserLanguageCode())}static{this.\u0275fac=function(i){return new(i||e)(l(k))}}static{this.\u0275cmp=g({type:e,selectors:[["chart-transactions-list"]],inputs:{transactions:"transactions"},standalone:!0,features:[C],decls:1,vars:1,consts:[[1,"list-group"],[1,"list-group-item","list-group-item-action","hstack","pe-0",3,"routerLink"],[1,"rounded-circle","d-flex"],[1,"vstack","ps-3","jcc"],[1,"jcb"],[1,"text-truncate"],[1,"jcc","px-3"],[1,"bi"]],template:function(i,s){i&1&&y(0,Q,3,0,"div",0),i&2&&S(s.transactions.length?0:-1)},dependencies:[v,B],encapsulation:2})}}return e})();function X(e,u){if(e&1&&(a(0,"section",0)(1,"div",2)(2,"span",3),m(3),r(),d(4,"period-selector"),r(),a(5,"div",4),d(6,"chart-transactions-doughnut",5),r(),a(7,"div",4),d(8,"chart-transactions-list",5),r(),d(9,"period-pagination"),r()),e&2){let t=x();c(3),f(t.categoryItem.title),c(3),p("transactions",t.transactions),c(2),p("transactions",t.transactions)}}function Y(e,u){e&1&&(a(0,"div",1)(1,"span",6),m(2,"Loading..."),r()())}var xt=(()=>{class e{constructor(t,i,s,h,n){this.twa=t,this.filter=i,this.service=s,this.activatedRoute=h,this.router=n,this.transactions=[],this.routeCreator=b,this.activatedRoute.data.subscribe(o=>{this.categoryItem=o.categoryItem})}ngOnInit(){this.loadTransactions(this.filter.fromTo),this.filterSubscription=this.filter.nextFromTo.pipe(D(1e3)).subscribe(t=>this.loadTransactions(t)),this.twa.backButtonOnClick(()=>this.goBack()),this.twa.setMainButton({text:"Add transaction",is_active:!0,is_visible:!0,has_shine_effect:!0},()=>this.onMainClick())}loadTransactions(t){this.service.list(new R(Object.assign(t,{categoryId:this.categoryItem.id}))).subscribe(i=>this.transactions=i)}ngOnDestroy(){this.serviceSubscription?.unsubscribe(),this.twa.offMainButton(()=>this.onMainClick()),this.twa.offBackButton(()=>this.goBack())}goBack(){this.router.navigate([b.main()])}onMainClick(){this.router.navigate([b.transactionAddByCategory(this.categoryItem)])}static{this.\u0275fac=function(i){return new(i||e)(l(k),l(q),l(F),l(E),l(j))}}static{this.\u0275cmp=g({type:e,selectors:[["ng-component"]],hostAttrs:[1,"d-flex","flex-column","h-100"],standalone:!0,features:[C],decls:2,vars:1,consts:[[1,"accent-border","accent-border-top","accent-bg-shadow","card","rounded-5"],["role","status",1,"m-auto","spinner-border"],[1,"hstack","p-3","pb-0"],[1,"m-auto","text-center","h5"],[1,"card-body","p-2"],[3,"transactions"],[1,"visually-hidden"]],template:function(i,s){i&1&&y(0,X,10,3,"section",0)(1,Y,3,0,"div",1),i&2&&S(s.transactions.length?0:1)},dependencies:[v,U,W,G,z],encapsulation:2})}}return e})();export{xt as ChartCategoryComponent};
